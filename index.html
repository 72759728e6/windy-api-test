<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
</head>
<body>
    <h1>Weather App</h1>
    <div id="weatherInfo"></div>

    <script>
        async function fetchWeatherData(coordinates) {
            const apiKey = 'hUp6XnjoQEfBX0teyVTSwnPy6qEgJzLP'; // Replace 'YOUR_API_KEY' with your actual API key
            const apiUrl = 'https://api.windy.com/api/point-forecast/v2';

            // Create array to store wind speeds
            const windSpeeds = [];

            // Iterate over each coordinate
            for (const coordinate of coordinates) {
                const [latitude, longitude] = coordinate.split(' ');

                // Create request body
                const requestBody = {
                    lat: parseFloat(latitude),
                    lon: parseFloat(longitude),
                    model: 'gfs',
                    parameters: ['wind'],
                    key: apiKey
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch data: ' + response.status);
                    }

                    const data = await response.json();

                    // Check if the data structure is as expected
                    if (data && data.hours && data.hours[0] && data.hours[0].wind && data.hours[0].wind[0] && data.hours[0].wind[0].speed) {
                        const windSpeed = data.hours[0].wind[0].speed; // Extract wind speed
                        windSpeeds.push(windSpeed);
                    } else {
                        console.error('Error: Invalid data structure in API response:', data);
                        windSpeeds.push('Error: Invalid data structure');
                    }
                } catch (error) {
                    console.error('Error fetching data:', error);
                    windSpeeds.push('Error fetching data');
                }
            }

            // Display wind speeds on the page
            document.getElementById('weatherInfo').innerText = windSpeeds.join('\n');
        }

        // Read coordinates from lat-long-400.txt file in the same GitHub repository
        fetch('https://raw.githubusercontent.com/72759728e6/windy-api-test/master/lat-long-400.txt')
            .then(response => response.text())
            .then(text => {
                const coordinates = text.split('\n');
                fetchWeatherData(coordinates);
            })
            .catch(error => console.error('Error reading coordinates file:', error));
    </script>
</body>
</html>
